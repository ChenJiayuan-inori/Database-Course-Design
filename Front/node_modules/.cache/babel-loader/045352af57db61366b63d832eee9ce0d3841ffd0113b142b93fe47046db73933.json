{"ast":null,"code":"import Vue from 'vue';\nimport VueRouter from 'vue-router';\nimport { jwtDecode } from \"jwt-decode\";\nVue.use(VueRouter);\nconst routes = [{\n  path: '/login',\n  name: 'mytest',\n  component: () => import( /* webpackChunkName: \"about\" */'../views/MyTest.vue')\n}, {\n  path: '/',\n  name: 'index',\n  redirect: '/login'\n}, {\n  path: '/backpage',\n  name: 'backpage',\n  component: () => import('../views/BackPage.vue')\n}];\nconst router = new VueRouter({\n  routes\n});\n\n/*路由守卫   根据登录获得token*/\n\nrouter.beforeEach((to, from, next) => {\n  const isLogin = localStorage.Token ? true : false;\n  console.log(isLogin);\n  if (to.path === \"/login\" || to.path === \"/\") {\n    next();\n    return;\n  } else {\n    if (isLogin) {\n      try {\n        const token = jwtDecode(localStorage.getItem('Token'));\n        const expire = token.exp * 1000;\n        const now = new Date().getTime();\n        if (now > expire) {\n          // 如果令牌已过期，则删除localStorage中的token并重新登录或提示用户重新登录\n          localStorage.removeItem('Token');\n          alert('您的登录已过期，请重新登录。');\n          next('/login');\n        } else {\n          //如果令牌未过期，则将token保存到localStorage中，并继续访问该路由\n          localStorage.setItem('Token', localStorage.getItem('Token'));\n          next();\n        }\n      } catch (error) {\n        console.log(error);\n        next('/login');\n      }\n    } else {\n      this.$message({\n        type: \"error\",\n        message: \"Not Login! Please login your account.\"\n      });\n      next('/login');\n    }\n  }\n});\nexport default router;","map":{"version":3,"names":["Vue","VueRouter","jwtDecode","use","routes","path","name","component","redirect","router","beforeEach","to","from","next","isLogin","localStorage","Token","console","log","token","getItem","expire","exp","now","Date","getTime","removeItem","alert","setItem","error","$message","type","message"],"sources":["C:/Users/83407/Desktop/vue/vue-project/src/router/index.js"],"sourcesContent":["import Vue from 'vue'\nimport VueRouter from 'vue-router'\nimport { jwtDecode } from \"jwt-decode\"\n\n\nVue.use(VueRouter)\n\nconst routes = [\n\t{\n\t\tpath: '/login',\n\t\tname: 'mytest',\n\t\tcomponent: () => import(/* webpackChunkName: \"about\" */ '../views/MyTest.vue')\n\t},\n\t{\n\t\tpath: '/',\n\t\tname: 'index',\n\t\tredirect: '/login'\n\t},\n\t{\n\t\tpath: '/backpage',\n\t\tname: 'backpage',\n\t\tcomponent: () => import('../views/BackPage.vue')\n\t},\n]\n\n\nconst router = new VueRouter({\n\troutes\n})\n\n/*路由守卫   根据登录获得token*/\n\nrouter.beforeEach((to, from, next) => {\n\n\tconst isLogin = localStorage.Token ? true : false;\n\tconsole.log(isLogin)\n\n\tif (to.path === \"/login\" || to.path === \"/\") {\n\t\tnext();\n\t\treturn;\n\t}\n\telse {\n\t\tif (isLogin) {\n\t\t\ttry {\n\t\t\t\tconst token = jwtDecode(localStorage.getItem('Token'));\n\t\t\t\tconst expire = token.exp * 1000;\n\t\t\t\tconst now = new Date().getTime();\n\t\t\t\tif (now > expire) {\n\t\t\t\t\t// 如果令牌已过期，则删除localStorage中的token并重新登录或提示用户重新登录\n\t\t\t\t\tlocalStorage.removeItem('Token');\n\t\t\t\t\talert('您的登录已过期，请重新登录。');\n\t\t\t\t\tnext('/login');\n\t\t\t\t} else {\n\t\t\t\t\t//如果令牌未过期，则将token保存到localStorage中，并继续访问该路由\n\t\t\t\t\tlocalStorage.setItem('Token', localStorage.getItem('Token'));\n\t\t\t\t\tnext();\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (error) {\n\t\t\t\tconsole.log(error);\n\t\t\t\tnext('/login');\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.$message({\n\t\t\t\ttype: \"error\",\n\t\t\t\tmessage: \"Not Login! Please login your account.\",\n\t\t\t});\n\t\t\tnext('/login');\n\t\t}\n\t}\n});\n\n\nexport default router\n"],"mappings":"AAAA,OAAOA,GAAG,MAAM,KAAK;AACrB,OAAOC,SAAS,MAAM,YAAY;AAClC,SAASC,SAAS,QAAQ,YAAY;AAGtCF,GAAG,CAACG,GAAG,CAACF,SAAS,CAAC;AAElB,MAAMG,MAAM,GAAG,CACd;EACCC,IAAI,EAAE,QAAQ;EACdC,IAAI,EAAE,QAAQ;EACdC,SAAS,EAAEA,CAAA,KAAM,MAAM,EAAC,+BAAgC,qBAAqB;AAC9E,CAAC,EACD;EACCF,IAAI,EAAE,GAAG;EACTC,IAAI,EAAE,OAAO;EACbE,QAAQ,EAAE;AACX,CAAC,EACD;EACCH,IAAI,EAAE,WAAW;EACjBC,IAAI,EAAE,UAAU;EAChBC,SAAS,EAAEA,CAAA,KAAM,MAAM,CAAC,uBAAuB;AAChD,CAAC,CACD;AAGD,MAAME,MAAM,GAAG,IAAIR,SAAS,CAAC;EAC5BG;AACD,CAAC,CAAC;;AAEF;;AAEAK,MAAM,CAACC,UAAU,CAAC,CAACC,EAAE,EAAEC,IAAI,EAAEC,IAAI,KAAK;EAErC,MAAMC,OAAO,GAAGC,YAAY,CAACC,KAAK,GAAG,IAAI,GAAG,KAAK;EACjDC,OAAO,CAACC,GAAG,CAACJ,OAAO,CAAC;EAEpB,IAAIH,EAAE,CAACN,IAAI,KAAK,QAAQ,IAAIM,EAAE,CAACN,IAAI,KAAK,GAAG,EAAE;IAC5CQ,IAAI,CAAC,CAAC;IACN;EACD,CAAC,MACI;IACJ,IAAIC,OAAO,EAAE;MACZ,IAAI;QACH,MAAMK,KAAK,GAAGjB,SAAS,CAACa,YAAY,CAACK,OAAO,CAAC,OAAO,CAAC,CAAC;QACtD,MAAMC,MAAM,GAAGF,KAAK,CAACG,GAAG,GAAG,IAAI;QAC/B,MAAMC,GAAG,GAAG,IAAIC,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC;QAChC,IAAIF,GAAG,GAAGF,MAAM,EAAE;UACjB;UACAN,YAAY,CAACW,UAAU,CAAC,OAAO,CAAC;UAChCC,KAAK,CAAC,gBAAgB,CAAC;UACvBd,IAAI,CAAC,QAAQ,CAAC;QACf,CAAC,MAAM;UACN;UACAE,YAAY,CAACa,OAAO,CAAC,OAAO,EAAEb,YAAY,CAACK,OAAO,CAAC,OAAO,CAAC,CAAC;UAC5DP,IAAI,CAAC,CAAC;QACP;MACD,CAAC,CACD,OAAOgB,KAAK,EAAE;QACbZ,OAAO,CAACC,GAAG,CAACW,KAAK,CAAC;QAClBhB,IAAI,CAAC,QAAQ,CAAC;MACf;IACD,CAAC,MACI;MACJ,IAAI,CAACiB,QAAQ,CAAC;QACbC,IAAI,EAAE,OAAO;QACbC,OAAO,EAAE;MACV,CAAC,CAAC;MACFnB,IAAI,CAAC,QAAQ,CAAC;IACf;EACD;AACD,CAAC,CAAC;AAGF,eAAeJ,MAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}